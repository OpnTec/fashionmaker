language: cpp

matrix:
  include:
    - os: linux
      dist: trusty
      sudo: required
      compiler: clang
    - os: osx
      compiler: clang

before_install:
  - |
    if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
      sudo apt-get -qq update;
      sudo apt-get install -y qtbase5-dev;
      sudo apt-get install -y libqt5svg5-dev;
      sudo apt-get install -y qt5-default;
      sudo apt-get install -y qttools5-dev-tools;
      sudo apt-get install -y libqt5xmlpatterns5-dev;
      sudo apt-get install -y libqt5core5a;
      sudo apt-get install -y libqt5gui5;
      sudo apt-get install -y libqt5printsupport5;
      sudo apt-get install -y libqt5svg5;
      sudo apt-get install -y libqt5widgets5;
      sudo apt-get install -y libqt5xml5;
      sudo apt-get install -y libqt5xmlpatterns5;
      sudo apt-get install -y xpdf;
      sudo apt-get install -y xvfb;
    else
      brew update > /dev/null;
      brew install qt5;
      chmod -R 755 /usr/local/opt/qt5/*
    fi

before_script:
  - |
    if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
      uname -a;
      which qmake;
    else
      QTDIR="/usr/local/opt/qt5";
      PATH="$QTDIR/bin:$PATH";
      LDFLAGS=-L$QTDIR/lib;
      CPPFLAGS=-I$QTDIR/include;
      PKG_CONFIG_PATH=/usr/local/opt/qt5/lib/pkgconfig;
    fi
  - mkdir build
  - cd build
  - pwd
  - qmake --version
  - qmake ../Valentina.pro -r CONFIG+=noDebugSymbols CONFIG+=no_ccache CONFIG+=checkWarnings

script:
  - $CXX --version
  - |
    if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
      make -j$(nproc)
      export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:"/home/travis/build/dismine/Valentina/build/src/libs/vpropertyexplorer/bin:/home/travis/build/dismine/Valentina/build/src/libs/qmuparser/bin";
      xvfb-run -a make --silent check TESTARGS="-silent";
    else
      make -j1
      export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:"/Users/travis/build/dismine/Valentina/build/src/libs/vpropertyexplorer/bin:/Users/travis/build/dismine/Valentina/build/src/libs/qmuparser/bin";
      make --silent check TESTARGS="-silent";
    fi  

notifications:
   email:
     recipients:
        - dismine@gmail.com
        - susan.spencer@gmail.com
     on_success: change
     on_failure: always

